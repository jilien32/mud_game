class World:
    def __init__(self):
        self.rooms = {
            # 튜토리얼 존
            (0, 0, 0): {
                "name": "튜토리얼 입구",
                "description": (
                    "당신은 꿈에서 깨어났습니다. 이곳은 MUD 세계로 향하는 문 앞입니다.\n"
                    "▶ 앞으로 이동하려면 [ㄷ] 또는 [동] 명령어를 사용하세요."
                ),
                "exits": {"동": (1, 0, 0)}
            },
            (1, 0, 0): {
                "name": "상태 확인 방",
                "description": (
                    "이곳은 당신의 상태를 확인할 수 있는 공간입니다.\n"
                    "▶ [상], [정보], [점수] 명령어로 스탯, 체력, 마력을 확인해보세요.\n"
                    "▶ 다음 방으로 가려면 [ㄷ] 명령어를 사용하세요."
                ),
                "exits": {"서": (0, 0, 0), "동": (2, 0, 0)}
            },
            (2, 0, 0): {
                "name": "채팅 연습 방",
                "description": (
                    "이 방에서는 대화하는 법을 배웁니다.\n"
                    "▶ [말], [잡], [속 대상이름 내용], [그] 명령어로 채팅해보세요.\n"
                    "▶ [누구]로 접속 중인 사람을 확인할 수 있습니다."
                ),
                "exits": {"서": (1, 0, 0), "동": (3, 0, 0)}
            },
            (3, 0, 0): {
                "name": "이동 연습 방",
                "description": (
                    "이동은 모험의 기본입니다.\n"
                    "▶ [ㄷ,ㅅ,ㅂ,ㄴ,ㅄ,ㅂㄷ,ㄴㅅ,ㄴㄷ,ㅇ,ㅁ] 명령어로 이동 방향을 바꿔보세요.\n"
                    "▶ 연습 후 [ㄷ]으로 다음 방으로 이동하세요."
                ),
                "exits": {"서": (2, 0, 0), "동": (4, 0, 0)}
            },
            (4, 0, 0): {
                "name": "지도 확인 방",
                "description": (
                    "이제 주변을 확인해볼 차례입니다.\n"
                    "▶ [지], [지도] 명령어로 5x5 미니맵을 확인하세요.\n"
                    "▶ 이 방에서 동쪽으로 나아가면 모험이 시작됩니다."
                ),
                "exits": {
                    "서": (3, 0, 0),
                    "동": (5, 0, 0),
                    "북": (4, 1, 0),
                    "남": (4, -1, 0),
                    "동": (5, 0, 0)
                }
            },

            # 광장 및 진입 지점 (튜토리얼 동쪽 끝)
            (5, 0, 0): {
                "name": "광장 입구",
                "description": (
                    "당신은 이제 진정한 모험의 시작점에 도달했습니다.\n"
                    "광장 중심부는 북, 남, 동, 서 방향으로 연결되어 있습니다."
                ),
                "exits": {
                    "서": (4, 0, 0),
                    "북": (5, 1, 0),
                    "남": (5, -1, 0),
                    "동": (6, 0, 0),
                    "서": (4, 0, 0)
                }
            },
            (5, 1, 0): {
                "name": "광장 북쪽",
                "description": "광장의 북쪽입니다. 고요한 바람이 불어옵니다.",
                "exits": {"남": (5, 0, 0)}
            },
            (5, -1, 0): {
                "name": "광장 남쪽",
                "description": "광장의 남쪽입니다. 바닥에 고대의 문양이 새겨져 있습니다.",
                "exits": {"북": (5, 0, 0)}
            },
            (6, 0, 0): {
                "name": "광장 동쪽",
                "description": "광장의 동쪽입니다. 성문이 보입니다.",
                "exits": {"서": (5, 0, 0)}
            },
            (4, 0, 0): {  # 지도 확인 방 수정됨
                "name": "지도 확인 방",
                "description": (
                    "이제 주변을 확인해볼 차례입니다.\n"
                    "▶ [지], [지도] 명령어로 5x5 미니맵을 확인하세요.\n"
                    "▶ 이 방에서 동쪽으로 나아가면 모험이 시작됩니다."
                ),
                "exits": {
                    "서": (3, 0, 0),
                    "동": (5, 0, 0),
                    "북": (4, 1, 0),
                    "남": (4, -1, 0)
                }
            },
        }

    def get_room(self, pos):
        return self.rooms.get(pos, {
            "name": "???",
            "description": "이 지역은 안개로 가득 차 있습니다.",
            "exits": {}
        })

    def get_new_position(self, current, direction):
        dx, dy, dz = {
            "동": (1, 0, 0), "서": (-1, 0, 0),
            "남": (0, -1, 0), "북": (0, 1, 0),
            "북서": (-1, 1, 0), "북동": (1, 1, 0),
            "남서": (-1, -1, 0), "남동": (1, -1, 0),
            "위": (0, 0, 1), "밑": (0, 0, -1)
        }.get(direction, (0, 0, 0))
        return (current[0] + dx, current[1] + dy, current[2] + dz)

    def room_exists(self, position):
        return position in self.rooms
